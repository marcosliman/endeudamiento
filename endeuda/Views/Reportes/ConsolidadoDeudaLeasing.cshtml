@{
    ViewBag.Title = "Reporte Deuda Leasing";
}
@{
    var NombreMenu = "Familia";
    tesoreria.Helper.Seguridad seguridad = System.Web.HttpContext.Current.Session["Seguridad"] as tesoreria.Helper.Seguridad;
    var TieneCrear = seguridad.TienePermiso(NombreMenu, tesoreria.Helper.TipoAcceso.Crear);
    var TieneEditar = seguridad.TienePermiso(NombreMenu, tesoreria.Helper.TipoAcceso.Editar);
    var TieneEliminar = seguridad.TienePermiso(NombreMenu, tesoreria.Helper.TipoAcceso.Eliminar);
}
<div class="d-sm-flex align-items-center justify-content-between">
    <h5 class="h5 mb-0 text-gray-800">Hola @seguridad.Nombre, </h5>
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/Home/Inicio">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Inicio</li>
    </ol>
</div>
<h5 class="h5 mb-0 text-gray-800">Acá puedes revisar el reporte Consolidado de tus deudas Leasing al Fecha</h5>
<br>
<div class="row">
    <div class="col-md-12">
        <div class="card card-outline card-info collapsed-card">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Filtros</h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-2">
                            <select name="empresa" class="form-control">
                                <option>--Seleccione Empresa--</option>
                                <option value="1">Todas</option>
                                <option value="2">MAQSUR S.A.</option>
                                <option value="3">BIOMASA</option>
                                <option value="3">TECSUR</option>
                                <option value="3">MQS</option>
                                <option value="3">NOK</option>
                            </select>
                        </div>
                        <div class="col-sm-2">
                            <select name="banco" class="form-control">
                                <option>--Seleccione Banco--</option>
                                <option value="1">Todas</option>
                                <option value="2">BCI</option>
                                <option value="3">SANTANDER</option>
                                <option value="3">SCOTIABANK</option>
                            </select>
                        </div>
                        <div class="col-sm-2">
                            <select name="anio" class="form-control">
                                <option>--Seleccione Año--</option>
                                <option value="1">2021</option>
                                <option value="2">2022</option>
                                <option value="3">2023</option>
                                <option value="4">2024</option>
                                <option value="5">2025</option>
                                <option value="6">2026</option>
                                <option value="7">2027</option>
                                <option value="8">2028</option>
                                <option value="9">2029</option>
                                <option value="10">2030</option>
                                <option value="11">2031</option>
                                <option value="12">2032</option>
                            </select>
                        </div>
                        <div class="col-sm-2">
                            <select name="empresa" class="form-control">
                                <option>--Seleccione Mes--</option>
                                <option value="1">Enero</option>
                                <option value="2">Febrero</option>
                                <option value="3">Marzo</option>
                                <option value="4">Abril</option>
                                <option value="5">Mayo</option>
                                <option value="6">Junio</option>
                                <option value="7">Julio</option>
                                <option value="8">Agosto</option>
                                <option value="9">Septiembre</option>
                                <option value="10">Octubre</option>
                                <option value="11">Noviembre</option>
                                <option value="12">Diciembre</option>
                            </select>
                        </div>
                        <div class="col-sm-2">

                        </div>
                        <div class="col-sm-2">
                            <div class="row justify-content-end">
                                <button class="btn btn-info btn-sm " type="button" onclick="RefreshLista()"><i class="fa fa-cog"></i> Generar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Detalle</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <label for="inputEmail3" class="col-lg-12 col-form-label">Consolidado Deuda Leasing</label>
                <label for="inputEmail3" class="col-lg-12 col-form-label">Detalle al 31 de agosto del 2021.</label>
                <div class="row justify-content-end">
                    <button class="btn btn-info btn-sm " type="button" onclick="RefreshLista()"><i class="far fa-download"></i> Exportar .XLS</button>
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover dataTable dtr-inline" width="100%" id="grillaEmpresa" data-order='[[ 0, "asc" ]]'>
                        <thead class="thead-light">
                            <tr>
                                <th>Empresa</th>
                                <th>Banco</th>
                                <th>Núm. Ope./Contrato</th>
                                <th>Familia</th>
                                <th>Bien Adquirido</th>
                                <th>Total Rentas</th>
                                <th>Inicio</th>
                                <th>Op. Compra</th>
                                <th>Monto Inicial Deuda</th>
                                <th>Tasa Anual</th>
                                <th>Tipo Moneda</th>
                                <th>Cuota Neta</th>
                                <th>IVA</th>
                                <th>Cuota Bruta</th>
                                <th>Saldo Insoluto</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>
</div>
    <!-- DataTable with Hover -->
<script>
        $(document).ready(function () {
            AbrirMenu("@NombreMenu");
            initTable();
            moment.locale('es');
            $('#fecha').daterangepicker({
                autoUpdateInput: false,
                "locale": {
                    format: "DD/MM/YYYY",
                    "separator": " - ",
                    "applyLabel": "Aplicar",
                    "cancelLabel": "Limpiar",
                    "fromLabel": "DE",
                    "toLabel": "HASTA",
                    "customRangeLabel": "Personalizar",
                    "daysOfWeek": [
                        "Dom",
                        "Lun",
                        "Mar",
                        "Mie",
                        "Jue",
                        "Vie",
                        "Sáb"
                    ],
                    "monthNames": [
                        "Enero",
                        "Febrero",
                        "Marzo",
                        "Abril",
                        "Mayo",
                        "Junio",
                        "Julio",
                        "Agosto",
                        "Septiembre",
                        "Octubre",
                        "Noviembre",
                        "Diciembre"
                    ],
                    "firstDay": 1
                }
            });

            $('#fecha').on('apply.daterangepicker', function (ev, picker) {
                $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY'));
                //RefreshLista();
            });


            $('#fecha').on('cancel.daterangepicker', function (ev, picker) {
                $(this).val('');
                //RefreshLista();
            });
            $('#selectEmpresa').select2({
                placeholder: '---Seleccione Empresa---',
                language: "es",
                allowClear: true,
            });

        });
        function RefreshLista() {
            var table = initTable();
            table.ajax.reload(function (json) { });
        }
        function initTable() {
            var table = $('#grillaEmpresa').DataTable({
                "scrollX": true,
                "retrieve": true,
                'ajax': {
                    "type": "POST",
                    "url": '/Reportes/ConsolidadoDeudaLeasing_Read/0',
                    "data": function (d) {

                    },
                    "dataSrc": ""
                },
                columnDefs: [
                    { targets: '_all', className: 'align-middle' },
                    {
                        targets: [6,7],
                        render: function (data) {
                            var fecha = DateDatatable(data);
                            return fecha;
                        }
                    },
                    {
                        targets: [8, 11,12,13],
                        render: function (data, type, row) {
                            var numFormt = "";
                            if (data != null) {
                                var num = data.toString();
                                numFormt = SeparadorMiles(num);
                            }
                            return numFormt;
                        }
                    }
                ],
                columns: [
                    { "data": "RazonSocial" },
                    { "data": "NombreBanco" },
                    { "data": "NumeroContrato" },
                    { "data": "NombreFamilia" },
                    { "data": "DescripcionActivo" },
                    { "data": "Plazo" },
                    { "data": "FechaInicio" },
                    { "data": "FechaTermino" },
                    { "data": "Total" },
                    {
                        "mData": null,
                        "bSortable": true,
                        "mRender": function (o, type, row) {
                            var boton = '';
                            boton = o.TasaAnual + ' %';
                            return boton;
                        }
                    },
                    {
                        "mData": null,
                        "bSortable": true,
                        "mRender": function (o, type, row) {
                            var boton = '';
                            boton = o.TipoMoneda + ' CLP';
                            return boton;
                        }
                    },
                    {
                        "mData": null,
                        "bSortable": true,
                        "mRender": function (o, type, row) {
                            var boton = '';
                            boton = o.CuotaNeta + ' Falta';
                            return boton;
                        }
                    },
                    {
                        "mData": null,
                        "bSortable": true,
                        "mRender": function (o, type, row) {
                            var boton = '';
                            boton = o.IVA + ' Falta';
                            return boton;
                        }
                    },
                    {
                        "mData": null,
                        "bSortable": true,
                        "mRender": function (o, type, row) {
                            var boton = '';
                            boton = o.CuotaBruta + ' Falta';
                            return boton;
                        }
                    },
                    {
                        "mData": null,
                        "bSortable": true,
                        "mRender": function (o, type, row) {
                            var boton = '';
                            boton = o.SaldoInsoluto + ' Falta';
                            return boton;
                        }
                    },
                   
                ]
            });

            return table;
        }

</script>
    <script>
        $(document).ready(function () {

            $('#frmEdit').validate({
                debug: false,
                errorElement: "em",
                errorContainer: $("#warning")
            });
            $('#perfiles').select2({
                theme: 'bootstrap4'
            })
            window.top.esconderCargando();
        });

        function Success_dl(data) {
            esconderCargando();
            if (data.Estado == "0") {
                toastr.success(data.Mensaje);
                $('#modal-registro').modal('hide');
                RefreshLista();
            }
            else {
                toastr.error(data.Mensaje);
            }
        }
        function Failure_dl(data) {
            esconderCargando();
            toastr.error(data.Mensaje);
            $('#modal-registro').modal('hide');
        }

    </script>

