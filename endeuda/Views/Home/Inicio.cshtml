@{
    ViewBag.Title = "Dashboard";
}
<h5 class="h5 mb-0 text-gray-800">Demos un vistaso al desarrollo de los contratos y endeudamiento de todas las empresas.</h5>
<br />


<div class="card">
    <div class="card card-outline card-info collapsed-card">
        <div class="card-header">
            <h3 class="card-title">Filtros</h3>
            <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-auto">
                    <select name="empresa" class="form-control">
                        <option>--Seleccione Empresa--</option>
                        <option value="1">Todas</option>
                        <option value="2">MAQSUR S.A.</option>
                        <option value="3">BIOMASA</option>
                        <option value="3">TECSUR</option>
                        <option value="3">MQS</option>
                        <option value="3">NOK</option>
                    </select>
                </div>
                <div class="col-auto">
                    <select name="banco" class="form-control">
                        <option>--Seleccione Banco--</option>
                        <option value="1">Todas</option>
                        <option value="2">BCI</option>
                        <option value="3">SANTANDER</option>
                        <option value="3">SCOTIABANK</option>
                    </select>
                </div>
                <div class="col-auto">
                    <select name="anio" class="form-control">
                        <option>--Seleccione Año--</option>
                        <option value="1">2021</option>
                        <option value="2">2022</option>
                        <option value="3">2023</option>
                        <option value="4">2024</option>
                        <option value="5">2025</option>
                        <option value="6">2026</option>
                        <option value="7">2027</option>
                        <option value="8">2028</option>
                        <option value="9">2029</option>
                        <option value="10">2030</option>
                        <option value="11">2031</option>
                        <option value="12">2032</option>
                    </select>
                </div>
                <div class="col-auto">
                    <select name="empresa" class="form-control">
                        <option>--Seleccione Mes--</option>
                        <option value="1">Enero</option>
                        <option value="2">Febrero</option>
                        <option value="3">Marzo</option>
                        <option value="4">Abril</option>
                        <option value="5">Mayo</option>
                        <option value="6">Junio</option>
                        <option value="7">Julio</option>
                        <option value="8">Agosto</option>
                        <option value="9">Septiembre</option>
                        <option value="10">Octubre</option>
                        <option value="11">Noviembre</option>
                        <option value="12">Diciembre</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header" style="background-color:lightgrey">
                <h3 class="card-title">Deuda Vigente por Entidad Financiera</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div id="cont-venta-bruta" class="row m-0" style="display: block; position: relative; width: 100%;">
                            <div id="chart-cobranza" style="height: 200px;background-color: transparent;" data-highcharts-chart="15">

                            </div>
                        </div>
                        <script>
                            // Make monochrome colors
                            /* var pieColors = (function () {
                                    var colors = [],
                                        base = Highcharts.getOptions().colors[0],
                                        i;

                                    for (i = 0; i < 10; i += 1) {
                                        // Start out with a darkened base color (negative brighten), and end
                                        // up with a much brighter color
                                        colors.push(Highcharts.color(base).brighten((i - 3) / 7).get());
                                    }
                                    return colors;
                                }());
                                */
                            // Build the chart
                            Highcharts.chart('chart-cobranza', {
                                chart: {
                                    plotBackgroundColor: null,
                                    plotBorderWidth: null,
                                    plotShadow: false,
                                    type: 'pie'
                                },
                                exporting: {
                                    enabled: false
                                },
                                title: {
                                    text: ''
                                },
                                credits: {
                                    enabled: false
                                },
                                tooltip: {
                                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                                },
                                accessibility: {
                                    point: {
                                        valueSuffix: '%'
                                    }
                                },
                                plotOptions: {
                                    pie: {
                                        allowPointSelect: true,
                                        cursor: 'pointer',
                                        // colors: pieColors,
                                        dataLabels: {
                                            enabled: false,
                                            format: '{point.percentage:.1f} %',
                                            distance: -50,
                                            filter: {
                                                property: 'percentage',
                                                operator: '>',
                                                value: 4
                                            }
                                        }
                                    }
                                },
                                series: [{
                                    name: 'Share',
                                    data: [
                                        { name: 'BCI', y: 46 },
                                        { name: 'SANTANDER', y: 19 },
                                        { name: 'CHILE', y: 8 },
                                        { name: 'ESTADO', y: 7 },
                                        { name: 'SECURITY', y: 2 },
                                        { name: 'SCOTIABANK', y: 11 },
                                        { name: 'ITAÚ', y: 5 },
                                        { name: 'BICE', y: 2 },


                                    ]
                                }]
                            });
                        </script>
                    </div>
                    <div class="col-md-8">
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th rowspan="2">Entidad Financiera</th>
                                        <th>Monto Ch$</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>BCI</td>
                                        <th>$2.000.000</th>
                                    </tr>
                                    <tr>
                                        <td>SANTANDER</td>
                                        <th>$2.000.000</th>
                                    </tr>
                                    <tr>
                                        <td>SCOTIABANK</td>
                                        <th>$2.000.000</th>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


            </div>
        </div>
        <div class="card">
            <div class="card-header" style="background-color:lightgray">
                <h3 class="card-title">Total de Créditos</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <figure class="highcharts-figure" ">
                    <div id="chartEstadistico"></div>

                </figure>
                <script>
                    Highcharts.chart('chartEstadistico', {
                        chart: {
                            type: 'column'
                        },
                        title: {
                            text: ''
                        },
                        xAxis: {
                            categories: ['2021', '2022', '2023', '2024', '2025']
                        },
                        yAxis: {
                            allowDecimals: true,
                            min: 0,
                            title: {
                                text: 'MM$'
                            },
                            stackLabels: {
                                enabled: true,
                                style: {
                                    fontWeight: 'bold',
                                    color: ( // theme
                                        Highcharts.defaultOptions.title.style &&
                                        Highcharts.defaultOptions.title.style.color
                                    ) || 'gray'
                                }
                            }
                        },
                        /*legend: {
                            align: 'top',
                            x: -0,
                            verticalAlign: 'bottom',
                            y: 0,
                            floating: true,
                            backgroundColor:
                                Highcharts.defaultOptions.legend.backgroundColor || 'white',
                            borderColor: '#CCC',
                            borderWidth: 0,
                            shadow: false
                        },*/
                        tooltip: {
                            headerFormat: '<b>{point.x}</b><br/>',
                            pointFormat: '{series.name}: {point.y}<br/>Total: {point.stackTotal}'
                        },
                        plotOptions: {
                            column: {
                                stacking: 'normal',
                                dataLabels: {
                                    enabled: true
                                }
                            }
                        },
                        series: [{
                            name: 'Deuda Estructurada (Capital)',
                            data: [1200000, 1400000, 1300000, 1150000, 1060000]
                        }, {
                            name: 'Deuda Leasing (Capital)',
                            data: [1100000, 1300000, 1200000, 900000, 700000]
                        }]
                    });
                </script>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header" style="background-color:lightgrey">
                <h3 class="card-title">Deuda completa por Empresa</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div id="cont-venta-bruta" class="row m-0" style="display: block; position: relative; width: 100%;">
                            <div id="chart-deudacompleta" style="height: 200px;background-color: transparent;" data-highcharts-chart="15">

                            </div>
                        </div>
                        <script>
                            // Make monochrome colors
                            /* var pieColors = (function () {
                                    var colors = [],
                                        base = Highcharts.getOptions().colors[0],
                                        i;

                                    for (i = 0; i < 10; i += 1) {
                                        // Start out with a darkened base color (negative brighten), and end
                                        // up with a much brighter color
                                        colors.push(Highcharts.color(base).brighten((i - 3) / 7).get());
                                    }
                                    return colors;
                                }());
                                */
                            // Build the chart
                            Highcharts.chart('chart-deudacompleta', {
                                chart: {
                                    plotBackgroundColor: null,
                                    plotBorderWidth: null,
                                    plotShadow: false,
                                    type: 'pie'
                                },
                                exporting: {
                                    enabled: false
                                },
                                title: {
                                    text: ''
                                },
                                credits: {
                                    enabled: false
                                },
                                tooltip: {
                                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                                },
                                accessibility: {
                                    point: {
                                        valueSuffix: '%'
                                    }
                                },
                                plotOptions: {
                                    pie: {
                                        allowPointSelect: true,
                                        cursor: 'pointer',
                                        // colors: pieColors,
                                        dataLabels: {
                                            enabled: false,
                                            format: '{point.percentage:.1f} %',
                                            distance: -50,
                                            filter: {
                                                property: 'percentage',
                                                operator: '>',
                                                value: 4
                                            }
                                        }
                                    }
                                },
                                series: [{
                                    name: 'Share',
                                    data: [
                                        { name: 'MAQSUR S.A.', y: 15 },
                                        { name: 'BIOMASA', y: 20 },
                                        { name: 'TECSUR', y: 20 },
                                        { name: 'MQS', y: 18 },
                                        { name: 'NOK', y: 27 },

                                    ]
                                }]
                            });
                        </script>
                    </div>
                    <div class="col-md-8">
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th rowspan="2">Empresa</th>
                                    </tr>
                                    <tr>
                                        <th>Monto</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>MAQSUR S.A.</td>
                                        <th>$15.000.000</th>
                                    </tr>
                                    <tr>
                                        <td>BIOMASA</td>
                                        <th>$20.000.000</th>
                                    </tr>
                                    <tr>
                                        <td>TECSUR</td>
                                        <th>$20.000.000</th>
                                    </tr>
                                    <tr>
                                        <td>MQS</td>
                                        <th>$18.000.000</th>
                                    </tr>
                                    <tr>
                                        <td>NOK</td>
                                        <th>$27.000.000</th>
                                    </tr>

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


            </div>
        </div>
        <div class="card">
            <div class="card-header" style="background-color:lightgrey">
                <h3 class="card-title">Resumen de deuda</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <div id="cont-venta-bruta" class="row m-0" style="display: block; position: relative; width: 100%;">
                            <div id="chart-consolidado" style="height: 100%;background-color: transparent;" data-highcharts-chart="15">

                            </div>
                        </div>
                        <script>
                            // Make monochrome colors
                            /* var pieColors = (function () {
                                    var colors = [],
                                        base = Highcharts.getOptions().colors[0],
                                        i;

                                    for (i = 0; i < 10; i += 1) {
                                        // Start out with a darkened base color (negative brighten), and end
                                        // up with a much brighter color
                                        colors.push(Highcharts.color(base).brighten((i - 3) / 7).get());
                                    }
                                    return colors;
                                }());
                                */
                            // Build the chart
                            Highcharts.chart('chart-consolidado', {
                                chart: {
                                    type: 'column'
                                },
                                title: {
                                    text: ''
                                },
                                credits: {
                                    enabled: false
                                },
                                tooltip: {
                                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                                },
                                xAxis: {
                                    categories: ['2021', '2022', '2023', '2024', '2025']
                                },
                                yAxis: {
                                    min: 0,
                                    title: {
                                        text: 'Total consolidado'
                                    }
                                },
                                legend: {
                                    reversed: true
                                },
                                plotOptions: {
                                    series: {
                                        stacking: 'normal'
                                    }
                                },
                                series: [{
                                    name: 'Cuota Leasing',
                                    data: [1000000, 1600000, 1250000, 700000, 600000]
                                }, {
                                    name: 'Cuota Amortización',
                                    data: [1000000, 900000, 1250000, 600000, 200000]
                                }, {
                                    name: 'Gasto Financiero',
                                    data: [200000, 150000, 80000, 20000, 50000]
                                }]
                            });
                        </script>
                    </div>

                </div>


            </div>
        </div>

    </div>
</div>



<script>
    var data = [
        {
            id: 0,
            text: 'Alicate PLano'
        },
        {
            id: 1,
            text: 'Alicate Universal'
        },
        {
            id: 2,
            text: 'Alicate Punta Redonda '
        },
        {
            id: 3,
            text: 'Destornillador estrella'
        },
        {
            id: 4,
            text: 'Destornillador Plano'
        }
    ];
    $(document).ready(function () {
        $('#grillaProductos').DataTable({
            "searching": false,
            buttons: [],
        });
        AbrirMenu('Solicitante');
        $("#stockMaterial").hide();
        $('#selectMaterial').select2({
            placeholder: 'Busque Material',
            language: "es",
            minimumInputLength: 3,
            data: data
            /*ajax: {
                url: '/Producto/Productos_Read/',
                dataType: 'json'
                // Additional AJAX parameters go here; see the end of this chapter for the full code of this example
            }*/
        });
        $('#selectMaterial').on('select2:select', function (e) {
            var data = e.params.data;
            $("#stockMaterial").show();
            $('#selectMaterial').val(null).trigger('change');
        });
    })

    function abreMaterial() {
        $("#datosBuscar").empty();
        $('#crear-material').modal('show');
        tmpUrl = "/Home/SolicitudCreaMaterial";
        $.ajax({
            url: tmpUrl,
            type: "Get",
            data: {},
            success: function (data) {
                $("#datosBuscar").empty();
                $("#datosBuscar").html(data);
                esconderCargando();
            }
        });
    }

</script>
